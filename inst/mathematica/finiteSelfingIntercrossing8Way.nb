(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     87154,       2372]
NotebookOptionsPosition[     84929,       2309]
NotebookOutlinePosition[     85466,       2330]
CellTagsIndexPosition[     85423,       2327]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"otherPairState", "[", "state_", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Mod", "[", 
       RowBox[{"state", ",", "2"}], "]"}], " ", "\[Equal]", " ", "0"}], ",", 
     RowBox[{"state", "-", "1"}], ",", 
     RowBox[{"state", "+", "1"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"startRelevant2", "[", "state_", "]"}], " ", ":=", " ", 
   RowBox[{"state", " ", "-", " ", 
    RowBox[{"Mod", "[", 
     RowBox[{
      RowBox[{"state", "+", "1"}], ",", " ", "2"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"startRelevant4", "[", "state_", "]"}], " ", ":=", " ", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"state", " ", "\[GreaterEqual]", " ", "5"}], ",", " ", "5", ",", 
     " ", "1"}], "]"}]}], ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"allPermutations", "[", "current_", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "permutationsOf", ",", " ", "horizontal", ",", " ", "vertical", ",", " ",
       "both"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"permutationsOf", " ", "=", " ", 
      RowBox[{"PermutationReplace", "[", 
       RowBox[{"current", ",", " ", "permutations"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"horizontal", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "&"}], "/@", 
       "permutationsOf"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertical", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", 
       "permutationsOf"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"both", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "&"}], "/@", 
       "permutationsOf"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"DeleteDuplicates", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
       "permutationsOf", ",", " ", "horizontal", ",", " ", "vertical", ",", 
        " ", "both"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"standardiseUsingPermutation", "=."}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Four", "-", 
    RowBox[{"way", " ", "states"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"permutations", " ", "=", " ", 
     RowBox[{"GroupElements", "[", 
      RowBox[{"PermutationGroup", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}], "}"}], "]"}], ",", " ", 
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4"}], "}"}], "}"}], "]"}], ",", " ", 
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"2", ",", "4"}], "}"}]}], "}"}], "]"}], ",", " ", 
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "4"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"2", ",", "3"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
      "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"states", " ", "=", " ", 
     RowBox[{"Tuples", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], ",", " ", "4"}], 
      "]"}]}], ";"}], "\n", 
   RowBox[{"(*", "Symmetries", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"standardiseUsingPermutation", "[", 
     RowBox[{"{", 
      RowBox[{"unique_", ",", " ", "standardised_", ",", " ", "remaining_"}], 
      "}"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"current", ",", "positions", ",", "permutationsOfCurrent"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"current", " ", "=", " ", 
        RowBox[{"First", "[", "remaining", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"permutationsOfCurrent", " ", "=", " ", 
        RowBox[{"allPermutations", "[", "current", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"unique", ",", "#1"}], "]"}], "&"}], "/@", 
         "permutationsOfCurrent"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Plus", "@@", 
           RowBox[{"(", 
            RowBox[{"Flatten", "[", "positions", "]"}], ")"}]}], " ", 
          "\[Equal]", " ", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"unique", ",", " ", "current"}], "]"}], ",", " ", 
           RowBox[{"Append", "[", 
            RowBox[{"standardised", ",", " ", "current"}], "]"}], ",", " ", 
           RowBox[{"Rest", "[", "remaining", "]"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"unique", ",", " ", 
           RowBox[{"Append", "[", 
            RowBox[{"standardised", ",", " ", 
             RowBox[{"unique", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"Flatten", "[", "positions", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
           " ", 
           RowBox[{"Rest", "[", "remaining", "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"states", " ", "=", " ", 
     RowBox[{
      RowBox[{"Nest", "[", 
       RowBox[{"standardiseUsingPermutation", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "}"}], ",", " ", 
          RowBox[{"{", "}"}], ",", " ", "states"}], "}"}], ",", 
        RowBox[{"Length", "[", "states", "]"}]}], "]"}], "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"statesWithCounts", "=", 
    RowBox[{"Tally", "[", "states", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"Length", "[", "statesWithCounts", "]"}], "\[IndentingNewLine]", 
   RowBox[{"states", " ", "=", " ", 
    RowBox[{"First", " ", "/@", "statesWithCounts"}]}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Eight", "-", 
    RowBox[{"way", " ", "states"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"permutations", " ", "=", " ", 
     RowBox[{"GroupElements", "[", 
      RowBox[{"PermutationGroup", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"1", ",", "2"}], "}"}], "}"}], "]"}], ",", " ", 
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"3", ",", "4"}], "}"}], "}"}], "]"}], ",", " ", 
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"5", ",", "6"}], "}"}], "}"}], "]"}], ",", " ", 
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"7", ",", "8"}], "}"}], "}"}], "]"}], ",", " ", 
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "3"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "4"}], "}"}]}], "}"}], "]"}], ",", " ", 
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"5", ",", "7"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"6", ",", "8"}], "}"}]}], "}"}], "]"}], ",", " ", 
         RowBox[{"Cycles", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "5"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"2", ",", "6"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"3", ",", "7"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"4", ",", "8"}], "}"}]}], "}"}], "]"}]}], "}"}], "]"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"originalStates", " ", "=", " ", 
     RowBox[{"Tuples", "[", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{"1", ",", "8"}], "]"}], ",", " ", "4"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "Symmetries", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"standardiseUsingPermutation", "[", 
     RowBox[{"{", 
      RowBox[{"unique_", ",", " ", "standardised_", ",", " ", "remaining_"}], 
      "}"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"current", ",", "positions", ",", "permutationsOfCurrent"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"current", " ", "=", " ", 
        RowBox[{"First", "[", "remaining", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"permutationsOfCurrent", " ", "=", " ", 
        RowBox[{"allPermutations", "[", "current", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"positions", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"unique", ",", "#1"}], "]"}], "&"}], "/@", 
         "permutationsOfCurrent"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Plus", "@@", 
           RowBox[{"(", 
            RowBox[{"Flatten", "[", "positions", "]"}], ")"}]}], " ", 
          "\[Equal]", " ", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Append", "[", 
            RowBox[{"unique", ",", " ", "current"}], "]"}], ",", " ", 
           RowBox[{"Append", "[", 
            RowBox[{"standardised", ",", " ", "current"}], "]"}], ",", " ", 
           RowBox[{"Rest", "[", "remaining", "]"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"unique", ",", " ", 
           RowBox[{"Append", "[", 
            RowBox[{"standardised", ",", " ", 
             RowBox[{"unique", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"Flatten", "[", "positions", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], "]"}], ",", 
           " ", 
           RowBox[{"Rest", "[", "remaining", "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"recursiveResults", " ", "=", " ", 
     RowBox[{"Nest", "[", 
      RowBox[{"standardiseUsingPermutation", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", "}"}], ",", " ", 
         RowBox[{"{", "}"}], ",", " ", "originalStates"}], "}"}], ",", 
       RowBox[{"Length", "[", "originalStates", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"states", " ", "=", " ", 
     RowBox[{"recursiveResults", "[", 
      RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"statesWithCounts", "=", 
    RowBox[{"Tally", "[", "states", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"Length", "[", "statesWithCounts", "]"}], "\[IndentingNewLine]", 
   RowBox[{"states", " ", "=", " ", 
    RowBox[{"First", " ", "/@", "statesWithCounts"}]}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rilMatrixFunction", "[", 
   RowBox[{"from_", ",", " ", "to_"}], "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "twoRecomb", ",", " ", "twoNonRecomb", ",", " ", "oneEach", ",", " ", 
      "twoRecombMatches", ",", " ", "twoNonRecombMatches", ",", " ", 
      "oneEachMatches", ",", " ", "permutationsOfTo"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"permutationsOfTo", " ", "=", " ", 
      RowBox[{"allPermutations", "[", "to", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"twoRecomb", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"twoNonRecomb", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"oneEach", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"from", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"from", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"twoRecombMatches", " ", "=", " ", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"twoRecomb", ",", " ", "#1"}], "]"}], "]"}], "&"}], "/@", 
         "permutationsOfTo"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"twoNonRecombMatches", " ", "=", " ", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"twoNonRecomb", ",", " ", "#1"}], "]"}], "]"}], "&"}], "/@",
          "permutationsOfTo"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"oneEachMatches", " ", "=", " ", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"oneEach", ",", " ", "#1"}], "]"}], "]"}], "&"}], "/@", 
         "permutationsOfTo"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"twoRecombMatches", " ", 
       FractionBox[
        SuperscriptBox["r", "2"], "4"]}], " ", "+", " ", 
      RowBox[{"twoNonRecombMatches", " ", 
       FractionBox[
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"1", "-", "r"}], ")"}], "2"], "4"]}], " ", "+", " ", 
      RowBox[{"oneEachMatches", " ", "r", 
       FractionBox[
        RowBox[{"(", 
         RowBox[{"1", "-", "r"}], ")"}], "4"]}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rilMatrix", " ", "=", " ", 
   RowBox[{"Outer", "[", 
    RowBox[{
    "rilMatrixFunction", ",", " ", "states", ",", " ", "states", ",", "1"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"TableForm", "[", 
   RowBox[{"rilMatrix", ",", " ", 
    RowBox[{"TableHeadings", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"states", ",", " ", "states"}], "}"}]}]}], "]"}], 
  ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "These", " ", "should", " ", "all", " ", "sum", " ", "to", " ", "1"}], 
  "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Plus", "@@", "#1"}], ")"}], "&"}], "/@", "rilMatrix"}], " ", "//",
   "Simplify"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Check", " ", "that", " ", "eigen", " ", "decomposition", " ", "works"}], 
   ",", " ", 
   RowBox[{
   "difference", " ", "should", " ", "be", " ", "a", " ", "zero", " ", 
    "matrix"}]}], "*)"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vectors", " ", "=", " ", 
   RowBox[{"Eigenvectors", "[", 
    RowBox[{"Transpose", "[", "rilMatrix", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"values", " ", "=", 
   RowBox[{"Eigenvalues", "[", 
    RowBox[{"Transpose", "[", "rilMatrix", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uniqueEigenValues", " ", "=", " ", 
   RowBox[{"DeleteDuplicates", "[", "values", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sortedEigenValues", " ", "=", " ", 
   RowBox[{
    RowBox[{"Function", "[", 
     RowBox[{
      RowBox[{"{", "eigenIndex", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"vector", ",", "allResults", ",", " ", "allResultsIsZero"}], 
         "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vector", " ", "=", " ", 
          RowBox[{"vectors", "[", 
           RowBox[{"[", 
            RowBox[{"eigenIndex", ",", "All"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"allResults", " ", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{
             RowBox[{"{", "currentEigenValue", "}"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"vector", " ", "currentEigenValue"}], " ", "-", " ", 
               RowBox[{"vector", ".", "rilMatrix"}]}], "//", 
              "FullSimplify"}]}], "]"}], "/@", "uniqueEigenValues"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"allResultsIsZero", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"AllTrue", "[", 
              RowBox[{"#1", ",", " ", 
               RowBox[{"Function", "[", 
                RowBox[{"x", ",", 
                 RowBox[{"x", "===", "0"}]}], "]"}]}], "]"}], ")"}], "&"}], "/@",
            "allResults"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Pick", "[", 
           RowBox[{"uniqueEigenValues", ",", " ", "allResultsIsZero"}], "]"}],
           "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}], "/@", 
    RowBox[{"Range", "[", 
     RowBox[{"1", ",", 
      RowBox[{"Length", "[", "states", "]"}]}], "]"}]}]}], ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Check", " ", "that", " ", "eigen", " ", "decomposition", " ", "has", " ", 
   "worked"}], "*)"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"decomposed", " ", "=", " ", 
   RowBox[{
    RowBox[{"Inverse", "[", 
     RowBox[{"Eigenvectors", "[", 
      RowBox[{"Transpose", "[", "rilMatrix", "]"}], "]"}], "]"}], " ", ".", 
    " ", 
    RowBox[{"DiagonalMatrix", "[", "sortedEigenValues", "]"}], ".", 
    RowBox[{"Eigenvectors", "[", 
     RowBox[{"Transpose", "[", "rilMatrix", "]"}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"AllTrue", "[", 
  RowBox[{
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"decomposed", " ", "-", " ", "rilMatrix"}], "//", 
     "FullSimplify"}], "]"}], ",", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"#1", " ", "===", " ", "0"}], ")"}], "&"}]}], "]"}]}], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Use", " ", "eigen", " ", "decomposition", " ", "to", " ", "take", " ", 
   "power"}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"power", " ", "=", " ", 
   RowBox[{
    RowBox[{"Inverse", "[", 
     RowBox[{"Eigenvectors", "[", 
      RowBox[{"Transpose", "[", "rilMatrix", "]"}], "]"}], "]"}], " ", ".", 
    " ", 
    RowBox[{"MatrixPower", "[", 
     RowBox[{
      RowBox[{"DiagonalMatrix", "[", "sortedEigenValues", "]"}], ",", "d"}], 
     "]"}], ".", 
    RowBox[{"Eigenvectors", "[", 
     RowBox[{"Transpose", "[", "rilMatrix", "]"}], "]"}]}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Check", " ", "that", " ", "the", " ", "limit", " ", "looks", " ", "right",
     " ", "in", " ", "the", " ", "case", " ", "of", " ", "infinite", " ", 
    "selfing"}], ",", " ", 
   RowBox[{"no", " ", "intercrossing"}]}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rilLimit", " ", "=", " ", 
   RowBox[{"Limit", "[", 
    RowBox[{"power", ",", " ", 
     RowBox[{"d", "\[Rule]", " ", "\[Infinity]"}], ",", " ", 
     RowBox[{"Assumptions", "\[Rule]", 
      RowBox[{
       RowBox[{"0", " ", "<", " ", "r"}], " ", "&&", " ", 
       RowBox[{"r", " ", "<", " ", 
        RowBox[{"1", "/", "2"}]}]}]}]}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"haplotypeProbability", "[", 
   RowBox[{"state1_", ",", "state2_"}], "]"}], " ", ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"startRelevant4", "[", "state1", "]"}], " ", "\[NotEqual]", " ", 
     RowBox[{"startRelevant4", "[", "state2", "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Different", " ", "halves"}], "*)"}], "\[IndentingNewLine]", "0",
     ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"The", " ", "same", " ", "half"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"startRelevant2", "[", "state1", "]"}], " ", "\[NotEqual]", 
       " ", 
       RowBox[{"startRelevant2", "[", "state2", "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Different", " ", "pairs", " ", "within", " ", "the", " ", "same", " ",
         "4"}], "*)"}], "\[IndentingNewLine]", 
      FractionBox["r", "8"], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"The", " ", "same", " ", "pair"}], ",", " ", 
        RowBox[{
        "so", " ", "they", " ", "could", " ", "be", " ", "the", " ", 
         "same"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"state1", " ", "\[Equal]", " ", "state2"}], ",", 
        FractionBox[
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"1", "-", "r"}], ")"}], "2"], "4"], ",", 
        RowBox[{"r", 
         FractionBox[
          RowBox[{"(", 
           RowBox[{"1", "-", "r"}], ")"}], "4"]}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"initialProbabilities", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"state", ",", " ", "count"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"state", " ", "=", " ", 
         RowBox[{"#1", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"count", " ", "=", " ", 
         RowBox[{"#1", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"startRelevant4", "[", 
             RowBox[{"state", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "\[Equal]", " ", 
            RowBox[{"startRelevant4", "[", 
             RowBox[{"state", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}], " ", "||", " ", 
           RowBox[{
            RowBox[{"startRelevant4", "[", 
             RowBox[{"state", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}], " ", "\[Equal]", " ", 
            RowBox[{"startRelevant4", "[", 
             RowBox[{"state", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "]"}]}], " ", "||", " ", 
           RowBox[{
            RowBox[{"startRelevant4", "[", 
             RowBox[{"state", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "\[NotEqual]", " ", 
            RowBox[{"startRelevant4", "[", 
             RowBox[{"state", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}]}], " ", "||", " ", 
           RowBox[{
            RowBox[{"startRelevant4", "[", 
             RowBox[{"state", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], " ", "\[NotEqual]", " ", 
            RowBox[{"startRelevant4", "[", 
             RowBox[{"state", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "]"}]}]}], ",", "0", ",", 
          RowBox[{
           FractionBox["count", "2"], " ", 
           RowBox[{"haplotypeProbability", "[", 
            RowBox[{
             RowBox[{"state", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], "]"}], 
           RowBox[{"haplotypeProbability", "[", 
            RowBox[{
             RowBox[{"state", "[", 
              RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}]}], "]"}]}]}], "]"}], 
     "&"}], "/@", "statesWithCounts"}]}], ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Plus", " ", "@@", "initialProbabilities"}], "//", 
  "FullSimplify"}]], "Input"],

Cell[BoxData[{
 RowBox[{"infiniteSelfing", " ", "=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"initialProbabilities", " ", ".", " ", "rilLimit"}], "/", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#1", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ")"}], "&"}], "/@", 
       "statesWithCounts"}], ")"}]}], " ", "//", "FullSimplify"}], 
   ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"Pick", "[", 
  RowBox[{"states", ",", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"#1", " ", "=!=", " ", "0"}], ")"}], "&"}], "/@", 
    "infiniteSelfing"}]}], "]"}]}], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Probabilities", " ", "for", " ", "a", " ", "finite", " ", "number", " ", 
    "of", " ", "generations", " ", "of", " ", "selfing"}], ",", " ", 
   RowBox[{
    RowBox[{"no", " ", 
     RowBox[{"intercossing", ".", " ", "This"}], " ", "can", " ", "be", " ", 
     "worked", " ", "out", " ", "for", " ", "the", " ", "8"}], "-", 
    RowBox[{
    "way", " ", "design", " ", "just", " ", "based", " ", "on", " ", "the", 
     " ", "2"}], "-", 
    RowBox[{"way", " ", "design"}]}], ",", " ", 
   RowBox[{
   "and", " ", "it", " ", "should", " ", "match", " ", "the", " ", 
    "eigenvalue", " ", "calculation", " ", "above"}]}], " ", "*)"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"fromPaper2way", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      FractionBox["1", 
       RowBox[{"2", 
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{"2", "r"}]}], ")"}]}]], " ", "-", " ", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox["1", "2"], ")"}], 
        RowBox[{"d", "+", "2"}]], 
       RowBox[{"(", 
        RowBox[{"2", " ", "-", " ", 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"1", " ", "-", " ", 
            RowBox[{"2", " ", "r"}], " ", "+", " ", 
            RowBox[{"2", " ", 
             SuperscriptBox["r", "2"]}]}], ")"}], "d"], " ", "+", " ", 
         FractionBox[
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", "r"}]}], ")"}], 
           RowBox[{"d", "+", "1"}]], 
          RowBox[{"1", "+", 
           RowBox[{"2", "r"}]}]]}], ")"}]}]}], ",", " ", 
     RowBox[{
      FractionBox["r", 
       RowBox[{"1", "+", 
        RowBox[{"2", "r"}]}]], " ", "-", " ", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"(", 
         FractionBox["1", "2"], ")"}], 
        RowBox[{"d", "+", "2"}]], 
       RowBox[{"(", 
        RowBox[{"2", " ", "-", " ", 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"1", " ", "-", " ", 
            RowBox[{"2", " ", "r"}], " ", "+", " ", 
            RowBox[{"2", " ", 
             SuperscriptBox["r", "2"]}]}], ")"}], "d"], " ", "-", " ", 
         FractionBox[
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"1", " ", "-", " ", 
             RowBox[{"2", "r"}]}], ")"}], 
           RowBox[{"d", "+", "1"}]], 
          RowBox[{"1", "+", 
           RowBox[{"2", "r"}]}]]}], ")"}]}]}], ",", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        FractionBox["1", "2"], ")"}], 
       RowBox[{"d", "+", "1"}]], 
      RowBox[{"(", 
       RowBox[{"1", " ", "-", " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"1", " ", "-", " ", 
           RowBox[{"2", "r"}], " ", "+", " ", 
           RowBox[{"2", 
            SuperscriptBox["r", "2"]}]}], ")"}], "d"]}], ")"}]}], ",", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        FractionBox["1", "2"], ")"}], 
       RowBox[{"d", "+", "1"}]], 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"1", " ", "-", " ", 
           RowBox[{"2", " ", "r"}], " ", "+", " ", 
           RowBox[{"2", 
            SuperscriptBox[
             RowBox[{"r", " "}], "2"]}]}], ")"}], "d"], " ", "+", " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"1", " ", "-", " ", 
           RowBox[{"2", "r"}]}], " ", ")"}], "d"]}], ")"}]}], ",", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        FractionBox["1", "2"], ")"}], 
       RowBox[{"d", "+", "1"}]], 
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"1", " ", "-", " ", 
           RowBox[{"2", " ", "r"}], " ", "+", " ", 
           RowBox[{"2", 
            SuperscriptBox[
             RowBox[{"r", " "}], "2"]}]}], ")"}], "d"], " ", "-", " ", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"1", " ", "-", " ", 
           RowBox[{"2", "r"}]}], " ", ")"}], "d"]}], ")"}]}]}], "}"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Plus", " ", "@@", " ", 
   RowBox[{"(", 
    RowBox[{"fromPaper2way", "*", " ", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2", ",", "4", ",", "1", ",", "1"}], "}"}]}], ")"}]}],
   " ", "//", "FullSimplify"}]}], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"permutationsF2", " ", "=", " ", 
   RowBox[{"GroupElements", "[", 
    RowBox[{"PermutationGroup", "[", 
     RowBox[{"{", 
      RowBox[{"Cycles", "[", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2"}], "}"}], "}"}], "]"}], "}"}], "]"}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"allPermutationsF2", "[", "current_", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "permutationsOf", ",", " ", "horizontal", ",", " ", "vertical", ",", " ",
       "both"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"permutationsOf", " ", "=", " ", 
      RowBox[{"PermutationReplace", "[", 
       RowBox[{"current", ",", " ", "permutationsF2"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"horizontal", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "&"}], "/@", 
       "permutationsOf"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vertical", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", 
       "permutationsOf"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"both", " ", "=", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"#1", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"#1", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "&"}], "/@", 
       "permutationsOf"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"DeleteDuplicates", "[", 
      RowBox[{"Join", "[", 
       RowBox[{
       "permutationsOf", ",", " ", "horizontal", ",", " ", "vertical", ",", 
        " ", "both"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expected8wayFiniteSelfingMatrixFunction", " ", "=", " ", 
   RowBox[{"Function", "[", 
    RowBox[{"state", ",", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "toStates", ",", " ", "permutationsToStates", ",", " ", "result", ",",
          " ", "positions", ",", " ", "indices", ",", " ", "f2Permutations"}],
         "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"result", " ", "=", " ", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", " ", 
           RowBox[{"Length", "[", "states", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"A", ",", "A", ",", "A", ",", "A"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"f2Permutations", " ", "=", " ", 
         RowBox[{"allPermutationsF2", "[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"toStates", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "+", "2"}], "]"}], "]"}], 
             ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "+", "2"}], "]"}], "]"}]}], 
            "}"}], "&"}], "/@", "f2Permutations"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"permutationsToStates", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"allPermutations", "/@", "toStates"}], ",", "1"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"states", ",", "#1"}], "]"}], "&"}], "/@", 
          "permutationsToStates"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"indices", " ", "=", " ", 
         RowBox[{"Flatten", "[", "positions", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"result", "[", 
             RowBox[{"[", "#1", "]"}], "]"}], " ", "=", " ", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", "#1", "]"}], "]"}], "+", 
             RowBox[{"fromPaper2way", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}], "&"}], "/@", 
         "indices"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"A", ",", "A", ",", "B", ",", "B"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"f2Permutations", " ", "=", " ", 
         RowBox[{"allPermutationsF2", "[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "2", ",", "2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"toStates", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "+", "2"}], "]"}], "]"}], 
             ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "+", "2"}], "]"}], "]"}]}], 
            "}"}], "&"}], "/@", "f2Permutations"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"permutationsToStates", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"allPermutations", "/@", "toStates"}], ",", "1"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"states", ",", "#1"}], "]"}], "&"}], "/@", 
          "permutationsToStates"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"indices", " ", "=", " ", 
         RowBox[{"Flatten", "[", "positions", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"result", "[", 
             RowBox[{"[", "#1", "]"}], "]"}], " ", "=", " ", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", "#1", "]"}], "]"}], "+", 
             RowBox[{"fromPaper2way", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}], "&"}], "/@", 
         "indices"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"A", ",", "A", ",", "A", ",", "B"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"f2Permutations", " ", "=", " ", 
         RowBox[{"allPermutationsF2", "[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "1", ",", "1", ",", "2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"toStates", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "+", "2"}], "]"}], "]"}], 
             ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "+", "2"}], "]"}], "]"}]}], 
            "}"}], "&"}], "/@", "f2Permutations"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"permutationsToStates", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"allPermutations", "/@", "toStates"}], ",", "1"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"states", ",", "#1"}], "]"}], "&"}], "/@", 
          "permutationsToStates"}]}], ";", 
        RowBox[{"indices", " ", "=", " ", 
         RowBox[{"Flatten", "[", "positions", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"result", "[", 
             RowBox[{"[", "#1", "]"}], "]"}], " ", "=", " ", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", "#1", "]"}], "]"}], "+", 
             RowBox[{
              FractionBox["1", "2"], 
              RowBox[{"fromPaper2way", "[", 
               RowBox[{"[", "3", "]"}], "]"}]}]}]}], ")"}], "&"}], "/@", 
         "indices"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"A", ",", "B", ",", "A", ",", "B"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"f2Permutations", " ", "=", " ", 
         RowBox[{"allPermutationsF2", "[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "1", ",", "2"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"toStates", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "+", "2"}], "]"}], "]"}], 
             ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "+", "2"}], "]"}], "]"}]}], 
            "}"}], "&"}], "/@", "f2Permutations"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"permutationsToStates", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"allPermutations", "/@", "toStates"}], ",", "1"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"states", ",", "#1"}], "]"}], "&"}], "/@", 
          "permutationsToStates"}]}], ";", 
        RowBox[{"indices", " ", "=", " ", 
         RowBox[{"Flatten", "[", "positions", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"result", "[", 
             RowBox[{"[", "#1", "]"}], "]"}], " ", "=", " ", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", "#1", "]"}], "]"}], "+", 
             RowBox[{
              FractionBox["1", "2"], 
              RowBox[{"fromPaper2way", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}]}]}], ")"}], "&"}], "/@", 
         "indices"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"A", ",", "B", ",", "B", ",", "A"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"f2Permutations", " ", "=", " ", 
         RowBox[{"allPermutationsF2", "[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2", ",", "2", ",", "1"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"toStates", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{"#1", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "+", "2"}], "]"}], "]"}], 
             ",", " ", 
             RowBox[{"state", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"#1", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], "+", "2"}], "]"}], "]"}]}], 
            "}"}], "&"}], "/@", "f2Permutations"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"permutationsToStates", " ", "=", " ", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"allPermutations", "/@", "toStates"}], ",", "1"}], "]"}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"positions", " ", "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{"states", ",", "#1"}], "]"}], "&"}], "/@", 
          "permutationsToStates"}]}], ";", 
        RowBox[{"indices", " ", "=", " ", 
         RowBox[{"Flatten", "[", "positions", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"result", "[", 
             RowBox[{"[", "#1", "]"}], "]"}], " ", "=", " ", 
            RowBox[{
             RowBox[{"result", "[", 
              RowBox[{"[", "#1", "]"}], "]"}], "+", 
             RowBox[{
              FractionBox["1", "2"], 
              RowBox[{"fromPaper2way", "[", 
               RowBox[{"[", "5", "]"}], "]"}]}]}]}], ")"}], "&"}], "/@", 
         "indices"}], ";", "\[IndentingNewLine]", 
        RowBox[{"result", "//", "FullSimplify"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expected8wayFiniteSelfingMatrix", " ", "=", 
   RowBox[{"expected8wayFiniteSelfingMatrixFunction", "/@", "states"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Plus", "@@", "#1"}], ")"}], "&"}], "/@", 
   "expected8wayFiniteSelfingMatrix"}], "//", "FullSimplify"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"expected8wayFiniteSelfing", "=", 
   RowBox[{"initialProbabilities", ".", "expected8wayFiniteSelfingMatrix"}]}],
   ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Plus", "@@", "expected8wayFiniteSelfing"}], "//", 
  "FullSimplify"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Check", " ", "that", " ", "asymptotically", " ", "we", " ", "have", " ", 
   "the", " ", "right", " ", "values"}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Limit", "[", 
   RowBox[{"expected8wayFiniteSelfing", ",", " ", 
    RowBox[{"d", "\[Rule]", "\[Infinity]"}], ",", 
    RowBox[{"Assumptions", "\[Rule]", " ", 
     RowBox[{
      RowBox[{"0", " ", "<", " ", "r"}], " ", "&&", " ", 
      RowBox[{"r", " ", "<", " ", 
       RowBox[{"1", "/", "2"}]}]}]}]}], "]"}], "/", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"#1", "[", 
       RowBox[{"[", "2", "]"}], "]"}], ")"}], "&"}], "/@", 
    "statesWithCounts"}], ")"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Ok", ",", " ", 
   RowBox[{
   "so", " ", "we", " ", "correctly", " ", "recreated", " ", "the", " ", 
    "results", " ", "from", " ", "the", " ", 
    RowBox[{"paper", ".", " ", "But"}], " ", "now", " ", "what", " ", "about",
     " ", "the", " ", "case", " ", "where", " ", "there", " ", "is", " ", 
    RowBox[{"intercrossing", "?"}]}]}], "*)"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"diseq", " ", "=", " ", 
   RowBox[{
    FractionBox[
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{"1", "-", "r"}], ")"}], "2"], "4"], " ", "-", " ", 
    FractionBox["1", "16"]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"specificNonRecombProb", " ", "=", " ", 
   RowBox[{
    RowBox[{"diseq", 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{"1", "-", "r"}], ")"}], 
      RowBox[{"nIntercrossing", "-", "1"}]]}], " ", "+", " ", 
    FractionBox["1", "16"]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"specificRecombProb", " ", "=", " ", 
   FractionBox[
    RowBox[{"(", 
     RowBox[{"1", " ", "-", 
      RowBox[{"4", " ", "specificNonRecombProb"}]}], ")"}], "12"]}], 
  ";"}]}], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "Vector", " ", "of", " ", "initial", " ", "probabilities", " ", "for", " ",
     "the", " ", "Markov", " ", "Chain"}], ",", " ", 
   RowBox[{
    RowBox[{"based", " ", "on", " ", "whether", " ", 
     RowBox[{"state", "[", 
      RowBox[{"[", "i", "]"}], "]"}], " ", "is", " ", "a", " ", "pair", " ", 
     "of", " ", "non"}], "-", "recombinants"}], ",", " ", 
   RowBox[{
   "pair", " ", "of", " ", "recombinants", " ", "or", " ", "one", " ", "of", 
    " ", 
    RowBox[{"each", "."}]}]}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{"Plus", " ", "@@", 
  RowBox[{"{", 
   RowBox[{"4", ",", "4", ",", "8", ",", "16", ",", 
    RowBox[{"(*", "5", "*)"}], "4", ",", "4", ",", "32", ",", " ", "32", ",", 
    "8", ",", 
    RowBox[{"(*", "10", "*)"}], "32", ",", "32", ",", "16", ",", "8", ",", 
    "16", ",", 
    RowBox[{"(*", "15", "*)"}], "16", ",", "8", ",", "8"}], "}"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Ordering", " ", "is", " ", "\[IndentingNewLine]", "1"}], " ", 
    "|", " ", 
    RowBox[{"2", "\[IndentingNewLine]", "3"}], " ", "|", " ", "4"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Swap", "[", 
      RowBox[{"i_", ",", " ", "j_", ",", " ", "k_"}], "]"}], ":=", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Module", "[", 
         RowBox[{
          RowBox[{"{", "original", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"original", "=", "#1"}], ";", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"original", "[", 
             RowBox[{"[", "i", "]"}], "]"}], " ", "=", " ", 
            RowBox[{"#1", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"original", "[", 
             RowBox[{"[", "j", "]"}], "]"}], " ", "=", " ", 
            RowBox[{"#1", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", "original"}]}], "]"}], "&"}], "/@", "k"}], 
      ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "1", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "3", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "4", ",", "4"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "2", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "3", ",", "3"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "3", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "4", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "4", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "2", ",", "2"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "4", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "2", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "2", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "1", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "3", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "3", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "4", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "3", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "3", ",", "4", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4", ",", "4", ",", "4"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "5", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "1", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "2", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4", ",", "3", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "3", ",", "4", ",", "3"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "6", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "1", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "4", ",", "4", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "3", ",", "3", ",", "4"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "7", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "2", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "2", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "4", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "1", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "1", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "3", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "4", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "4", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "1", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "4", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "1", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "2", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "3", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "3", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "1", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "2", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "1", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "4", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "4", ",", "4"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "4", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3", ",", "4", ",", "4"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "8", "]"}], " ", ":=", " ", 
     RowBox[{"Swap", "[", 
      RowBox[{"2", ",", "4", ",", " ", 
       RowBox[{"stateLists", "[", "7", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "9", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "2", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4", ",", "2", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3", ",", "1", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "4", ",", "1", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "4", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "4", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "1", ",", "3", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2", ",", "3", ",", "1"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "10", "]"}], " ", ":=", " ", 
     RowBox[{"Swap", "[", 
      RowBox[{"2", ",", "3", ",", 
       RowBox[{"stateLists", "[", "7", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "11", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "3", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "4", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "1", ",", "1", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "2", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "3", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "2", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "4", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "4", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2", ",", "2", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "3", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "1", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "3", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "3", ",", "2", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3", ",", "3", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "4", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "1", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "1", ",", "4", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4", ",", "4", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "4", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "2", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2", ",", "4", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "4", ",", "4", ",", "4"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "12", "]"}], " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "1", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "1", ",", "1", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "2", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2", ",", "2", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "3", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3", ",", "3", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4", ",", "4", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "4", ",", "4", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3", ",", "4", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"1", ",", "4", ",", "3", ",", "1"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3", ",", "4", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"2", ",", "4", ",", "3", ",", "2"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "1", ",", "2", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"3", ",", "2", ",", "1", ",", "3"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "1", ",", "2", ",", "4"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"4", ",", "2", ",", "1", ",", "4"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "13", "]"}], " ", ":=", " ", 
     RowBox[{"Swap", "[", 
      RowBox[{"2", ",", "3", ",", 
       RowBox[{"stateLists", "[", "3", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "14", "]"}], " ", ":=", " ", 
     RowBox[{"Swap", "[", 
      RowBox[{"1", ",", "3", ",", 
       RowBox[{"stateLists", "[", "12", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "15", "]"}], " ", ":=", " ", 
     RowBox[{"Swap", "[", 
      RowBox[{"1", ",", "4", ",", 
       RowBox[{"stateLists", "[", "14", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "16", "]"}], " ", ":=", " ", 
     RowBox[{"Swap", "[", 
      RowBox[{"2", ",", "4", ",", 
       RowBox[{"stateLists", "[", "3", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "17", "]"}], " ", ":=", " ", 
     RowBox[{"Swap", "[", 
      RowBox[{"3", ",", "4", ",", 
       RowBox[{"stateLists", "[", "9", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"stateLists", "[", "18", "]"}], " ", ":=", " ", 
     RowBox[{"Swap", "[", 
      RowBox[{"2", ",", "4", ",", 
       RowBox[{"stateLists", "[", "17", "]"}]}], "]"}]}], ";"}]}]}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"initialProb", " ", "=", " ", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"specificNonRecombProb", "*", "specificNonRecombProb"}], ",", 
      " ", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", " ", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", " ", 
      RowBox[{"specificNonRecombProb", "*", "specificRecombProb"}], ",", " ", 
      RowBox[{"specificNonRecombProb", "*", "specificNonRecombProb"}], ",", 
      " ", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", " ", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", " ", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", " ", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", " ", 
      RowBox[{"specificNonRecombProb", "*", "specificRecombProb"}], ",", 
      RowBox[{"specificNonRecombProb", "*", "specificRecombProb"}], ",", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", 
      RowBox[{"specificNonRecombProb", "*", "specificNonRecombProb"}], ",", 
      " ", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", " ", 
      RowBox[{"specificRecombProb", "*", "specificNonRecombProb"}], ",", " ", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", " ", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}], ",", 
      RowBox[{"specificRecombProb", "*", "specificRecombProb"}]}], "}"}], "*", 
    RowBox[{"Length", "/@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"stateLists", "[", "#1", "]"}], "&"}], " ", "/@", 
       RowBox[{"Range", "[", 
        RowBox[{"1", ",", "18"}], "]"}]}], ")"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Plus", " ", "@@", " ", "initialProb"}], "//", 
  "FullSimplify"}]}], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"combinedProbabilities", " ", "=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"initialProb", ".", "power"}], ")"}], "//", "FullSimplify"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{"selfingLimit", " ", "=", " ", 
  RowBox[{
   RowBox[{"Limit", "[", 
    RowBox[{"combinedProbabilities", ",", " ", 
     RowBox[{"d", "\[Rule]", " ", "\[Infinity]"}], ",", " ", 
     RowBox[{"Assumptions", "\[Rule]", 
      RowBox[{"0", " ", "<", " ", "r", " ", "<", " ", 
       RowBox[{"1", "/", "2"}]}]}]}], "]"}], "//", 
   "FullSimplify"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Has", " ", "the", " ", "correct", " ", "limit", " ", "with", " ", 
   "infinite", " ", "generations", " ", "of", " ", "selfing"}], 
  "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   FractionBox[
    RowBox[{"selfingLimit", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "4"], " ", "-", " ", 
   RowBox[{
    FractionBox["1", 
     RowBox[{"1", "+", 
      RowBox[{"2", "r"}]}]], 
    RowBox[{"(", 
     RowBox[{
      FractionBox[
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"1", "-", "r"}], ")"}], 
        RowBox[{"2", " ", "+", " ", "nIntercrossing", "-", "1"}]], "4"], " ", 
      "+", " ", 
      FractionBox[
       RowBox[{
        RowBox[{"2", "r"}], " ", "+", " ", "1", " ", "-", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"1", "-", "r"}], ")"}], 
         RowBox[{"nIntercrossing", "-", "1"}]]}], "16"]}], ")"}]}]}], "//", 
  "FullSimplify"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   FractionBox[
    RowBox[{"selfingLimit", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "4"], " ", "-", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"4", 
        FractionBox["1", 
         RowBox[{"1", "+", 
          RowBox[{"2", "r"}]}]], 
        RowBox[{"(", 
         RowBox[{
          FractionBox[
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"1", "-", "r"}], ")"}], 
            RowBox[{"2", " ", "+", " ", "nIntercrossing", "-", "1"}]], "4"], 
          " ", "+", " ", 
          FractionBox[
           RowBox[{
            RowBox[{"2", "r"}], " ", "+", " ", "1", " ", "-", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "-", "r"}], ")"}], 
             RowBox[{"nIntercrossing", "-", "1"}]]}], "16"]}], ")"}]}]}], 
      ")"}], "/", "12"}], ")"}]}], "//", "FullSimplify"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   FractionBox[
    RowBox[{"selfingLimit", "[", 
     RowBox[{"[", "3", "]"}], "]"}], "8"], " ", "-", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"4", 
        FractionBox["1", 
         RowBox[{"1", "+", 
          RowBox[{"2", "r"}]}]], 
        RowBox[{"(", 
         RowBox[{
          FractionBox[
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"1", "-", "r"}], ")"}], 
            RowBox[{"2", " ", "+", " ", "nIntercrossing", "-", "1"}]], "4"], 
          " ", "+", " ", 
          FractionBox[
           RowBox[{
            RowBox[{"2", "r"}], " ", "+", " ", "1", " ", "-", 
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "-", "r"}], ")"}], 
             RowBox[{"nIntercrossing", "-", "1"}]]}], "16"]}], ")"}]}]}], 
      ")"}], "/", "12"}], ")"}]}], "//", "FullSimplify"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "Rewrite", " ", "the", " ", "formula", " ", "into", " ", "something", " ", 
   "computable", " ", "more", " ", "efficiently"}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{"rewritten", "=", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"combinedProbabilities", "//", "Simplify"}], ")"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "-", "r"}], ")"}], 
             RowBox[{"1", "+", "nIntercrossing"}]], "\[Rule]", " ", 
            "powOneMinusR1"}], ",", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "-", "r"}], ")"}], 
             RowBox[{"nIntercrossing", "-", "1"}]], "\[Rule]", " ", 
            "powOneMinusR2"}], ",", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "-", "r"}], ")"}], 
             RowBox[{"2", " ", "nIntercrossing"}]], "\[Rule]", " ", 
            "powOneMinusR3"}], ",", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "-", "r"}], ")"}], "nIntercrossing"], " ", 
            "\[Rule]", " ", 
            RowBox[{"powOneMinusR2", "*", 
             RowBox[{"(", 
              RowBox[{"1", "-", "r"}], ")"}]}]}], ",", " ", 
           RowBox[{
            SuperscriptBox["2", 
             RowBox[{"1", "+", "d"}]], "\[Rule]", " ", 
            RowBox[{"2", "*", "pow2"}]}], ",", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{"2", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"-", "1"}], "+", "r"}], ")"}], " ", "r"}]}], ")"}], 
             "d"], "\[Rule]", "quadraticPower"}], ",", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"2", " ", "r"}]}], ")"}], "d"], "\[Rule]", " ", 
            "powOneMinus2R"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "3"}], "+", 
               RowBox[{"2", " ", "r"}]}], ")"}], " ", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "1"}], "+", 
               RowBox[{"2", " ", "r"}]}], ")"}]}], "\[Rule]", " ", 
            "quadratic2"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"3", "+", 
              RowBox[{"4", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"-", "2"}], "+", "r"}], ")"}], " ", "r"}]}], ")"}], 
            "\[Rule]", " ", "quadratic1"}], ",", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "3"}], "-", 
              RowBox[{"4", " ", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"-", "2"}], "+", "r"}], ")"}], " ", "r"}]}], ")"}], 
            "\[Rule]", " ", 
            RowBox[{"(", 
             RowBox[{"-", "quadratic1"}], ")"}]}], ",", 
           RowBox[{
            SuperscriptBox[
             RowBox[{"(", 
              RowBox[{
               RowBox[{"-", "1"}], "+", "r"}], ")"}], "2"], " ", "\[Rule]", 
            " ", "oneMinusRSquared"}]}], "}"}]}], ")"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"1", "-", "r"}], ")"}], 
           RowBox[{"1", "+", "nIntercrossing"}]], "\[Rule]", " ", 
          "powOneMinusR1"}], ",", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", " ", "r"}]}], ")"}], 
           RowBox[{"1", "+", "d"}]], "\[Rule]", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"2", "r"}]}], ")"}], "*", "powOneMinus2R"}]}]}], "}"}]}],
       ")"}], "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", 
          RowBox[{"2", "r"}]}], ")"}], "\[Rule]", "oneMinus2R"}], ",", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{"2", " ", "r"}]}], ")"}], "\[Rule]", " ", "onePlus2R"}], 
       ",", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "-", "r"}], ")"}], "\[Rule]", " ", "oneMinusR"}], ",", 
       " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], " ", "+", " ", "r"}], ")"}], " ", "\[Rule]", 
        " ", 
        RowBox[{"-", "oneMinusR"}]}], ",", " ", 
       RowBox[{
        SuperscriptBox["2", 
         RowBox[{
          RowBox[{"-", "6"}], "-", "d"}]], " ", "\[Rule]", " ", 
        FractionBox[
         SuperscriptBox["2", 
          RowBox[{"-", "6"}]], "pow2"]}], ",", " ", 
       RowBox[{
        SuperscriptBox["2", 
         RowBox[{
          RowBox[{"-", "4"}], "-", "d"}]], " ", "\[Rule]", " ", 
        FractionBox[
         SuperscriptBox["2", 
          RowBox[{"-", "4"}]], "pow2"]}], ",", " ", 
       RowBox[{
        SuperscriptBox["2", 
         RowBox[{
          RowBox[{"-", "5"}], "-", "d"}]], "\[Rule]", " ", 
        FractionBox[
         SuperscriptBox["2", 
          RowBox[{"-", "5"}]], "pow2"]}], ",", 
       RowBox[{
        SuperscriptBox["2", 
         RowBox[{
          RowBox[{"-", "7"}], "-", "d"}]], "\[Rule]", " ", 
        FractionBox[
         SuperscriptBox["2", 
          RowBox[{"-", "7"}]], "pow2"]}], ",", 
       RowBox[{
        SuperscriptBox["2", 
         RowBox[{
          RowBox[{"-", "3"}], "-", "d"}]], "\[Rule]", " ", 
        FractionBox[
         SuperscriptBox["2", 
          RowBox[{"-", "3"}]], "pow2"]}], ",", 
       RowBox[{
        SuperscriptBox["2", 
         RowBox[{"1", "+", "d"}]], "\[Rule]", " ", 
        RowBox[{"2", "*", "pow2"}]}]}], "}"}]}], ")"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      SuperscriptBox["quadratic1", "2"], "\[Rule]", " ", 
      "quadratic1Squared"}], ",", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "3"}], " ", "oneMinusR"}], "+", 
         RowBox[{"oneMinusR", " ", "powOneMinusR2", " ", "quadratic1"}]}], 
        ")"}], "2"], "\[Rule]", " ", "cubicPower"}], ",", " ", 
     RowBox[{
      SuperscriptBox["oneMinusR", 
       RowBox[{"-", "2"}]], " ", "\[Rule]", " ", 
      RowBox[{"1", "/", "oneMinusRSquared"}]}], ",", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"1", "+", 
         RowBox[{"powOneMinusR2", " ", "quadratic1"}]}], ")"}], "2"], 
      "\[Rule]", " ", "squaredFactor1"}], ",", " ", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"3", "-", 
         RowBox[{"powOneMinusR2", " ", "quadratic1"}]}], ")"}], "2"], 
      "\[Rule]", " ", 
      RowBox[{"cubicPower", "/", "oneMinusRSquared"}]}]}], "}"}]}]}]], "Input"],

Cell[BoxData[
 RowBox[{"InputForm", "[", "rewritten", "]"}]], "Input"]
},
WindowSize->{797, 670},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
PrintingCopies->1,
PrintingPageRange->{32000, 32000},
PrintingOptions->{"Magnification"->1.,
"PaperOrientation"->"Portrait",
"PaperSize"->{595.1999999999999, 841.8}},
TrackCellChangeTimes->False,
FrontEndVersion->"10.1 for Microsoft Windows (64-bit) (March 23, 2015)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 883, 25, 72, "Input"],
Cell[1444, 47, 2294, 61, 152, "Input"],
Cell[3741, 110, 71, 1, 31, "Input"],
Cell[3815, 113, 4200, 108, 452, "Input"],
Cell[8018, 223, 5067, 130, 452, "Input"],
Cell[13088, 355, 8776, 228, 446, "Input"],
Cell[21867, 585, 443, 13, 52, "Input"],
Cell[22313, 600, 134, 4, 31, "Input"],
Cell[22450, 606, 172, 6, 31, "Input"],
Cell[22625, 614, 264, 8, 31, "Input"],
Cell[22892, 624, 2377, 61, 272, "Input"],
Cell[25272, 687, 151, 4, 31, "Input"],
Cell[25426, 693, 716, 20, 72, "Input"],
Cell[26145, 715, 147, 4, 31, "Input"],
Cell[26295, 721, 477, 13, 52, "Input"],
Cell[26775, 736, 295, 7, 31, "Input"],
Cell[27073, 745, 398, 10, 31, "Input"],
Cell[27474, 757, 4268, 106, 508, "Input"],
Cell[31745, 865, 115, 3, 31, "Input"],
Cell[31863, 870, 647, 20, 72, "Input"],
Cell[32513, 892, 704, 16, 72, "Input"],
Cell[33220, 910, 3684, 113, 158, "Input"],
Cell[36907, 1025, 2613, 71, 206, "Input"],
Cell[39523, 1098, 12917, 325, 1137, "Input"],
Cell[52443, 1425, 173, 4, 45, "Input"],
Cell[52619, 1431, 194, 6, 45, "Input"],
Cell[52816, 1439, 167, 4, 45, "Input"],
Cell[52986, 1445, 115, 3, 45, "Input"],
Cell[53104, 1450, 176, 4, 31, "Input"],
Cell[53283, 1456, 545, 16, 52, "Input"],
Cell[53831, 1474, 400, 8, 52, "Input"],
Cell[54234, 1484, 772, 24, 121, "Input"],
Cell[55009, 1510, 565, 14, 72, "Input"],
Cell[55577, 1526, 376, 8, 31, "Input"],
Cell[55956, 1536, 16452, 404, 932, "Input"],
Cell[72411, 1942, 1877, 37, 252, "Input"],
Cell[74291, 1981, 201, 6, 31, "Input"],
Cell[74495, 1989, 381, 9, 31, "Input"],
Cell[74879, 2000, 195, 5, 31, "Input"],
Cell[75077, 2007, 756, 25, 53, "Input"],
Cell[75836, 2034, 944, 29, 76, "Input"],
Cell[76783, 2065, 944, 29, 76, "Input"],
Cell[77730, 2096, 188, 4, 31, "Input"],
Cell[77921, 2102, 6931, 202, 316, "Input"],
Cell[84855, 2306, 70, 1, 31, "Input"]
}
]
*)

(* End of internal cache information *)
